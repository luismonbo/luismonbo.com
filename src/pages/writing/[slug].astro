---
// Dynamic route for individual blog posts
// [slug].astro creates routes like /writing/ai-engineering-principles

import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// getStaticPaths() tells Astro which pages to generate at build time
// Required for dynamic routes in static mode
export async function getStaticPaths() {
  // Get all posts from the 'writing' collection
  const posts = await getCollection('writing');

  // Filter out drafts - only published posts get pages
  const publishedPosts = posts.filter(post => !post.data.draft);

  // Return array of { params, props } objects
  // params.slug determines the URL
  // props passes data to the component below
  return publishedPosts.map(post => ({
    params: { slug: post.slug }, // post.slug comes from filename
    props: { post }, // pass the full post object as a prop
  }));
}

// Destructure post from Astro.props
const { post } = Astro.props;

// Render the markdown content to HTML
// This is a special Astro API for content collections
const { Content } = await post.render();

// Format date for display (e.g., "January 15, 2026")
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(post.data.pubDate);
---

<Layout
	title={`${post.data.title} · luismonbo`}
	description={post.data.description}
>
  <!-- Article container -->
  <article class="max-w-none">
    <!-- Post header with title and metadata -->
    <!-- SPACING: More space after header (mb-12) -->
    <header class="mb-12">
      <!-- TYPOGRAPHY: Larger, more dramatic title (text-5xl) -->
      <!-- SPACING: More space after title (mb-4) -->
      <h1 class="text-5xl font-bold tracking-tight leading-tight mb-4">
        {post.data.title}
      </h1>

      <!-- Metadata: date and tags -->
      <div class="flex items-center gap-4 text-base text-gray-500">
        <time datetime={post.data.pubDate.toISOString()}>
          {formattedDate}
        </time>

        {post.data.tags && post.data.tags.length > 0 && (
          <div class="flex items-center gap-2">
            {post.data.tags.map(tag => (
              <span class="text-gray-400">#{tag}</span>
            ))}
          </div>
        )}
      </div>
    </header>

    <!-- Rendered markdown content -->
    <!-- TYPOGRAPHY: Better prose styling with improved contrast -->
    <!-- CONTRAST: Darker body text (prose-gray-900) -->
    <div class="prose prose-lg prose-gray max-w-none prose-headings:font-semibold prose-headings:tracking-tight prose-headings:text-gray-900 prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-gray-900 prose-a:underline hover:prose-a:text-gray-600 prose-strong:text-gray-900">
      <Content />
    </div>
  </article>

  <!-- Back link -->
  <!-- SPACING: More space above divider (mt-16) -->
  <div class="mt-16 pt-8 border-t border-gray-100">
    <a
      href="/writing"
      class="text-base text-gray-500 hover:text-gray-900 transition-colors"
    >
      ← Back to writing
    </a>
  </div>
</Layout>
